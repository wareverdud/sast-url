var e={d:(n,t)=>{for(var o in t)e.o(t,o)&&!e.o(n,o)&&Object.defineProperty(n,o,{enumerable:!0,get:t[o]})},o:(e,n)=>Object.prototype.hasOwnProperty.call(e,n)},n={};function t(){}function o(e,n,t,o,r){for(var i,s=[];n;)s.push(n),i=n.previousComponent,delete n.previousComponent,n=i;s.reverse();for(var a=0,l=s.length,u=0,c=0;a<l;a++){var d=s[a];if(d.removed){if(d.value=e.join(o.slice(c,c+d.count)),c+=d.count,a&&s[a-1].added){var f=s[a-1];s[a-1]=s[a],s[a]=f}}else{if(!d.added&&r){var p=t.slice(u,u+d.count);p=p.map((function(e,n){var t=o[c+n];return t.length>e.length?t:e})),d.value=e.join(p)}else d.value=e.join(t.slice(u,u+d.count));u+=d.count,d.added||(c+=d.count)}}var h=s[l-1];return l>1&&"string"==typeof h.value&&(h.added||h.removed)&&e.equals("",h.value)&&(s[l-2].value+=h.value,s.pop()),s}e.d(n,{Z:()=>k,k:()=>S}),t.prototype={diff:function(e,n){var t,r=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},i=r.callback;"function"==typeof r&&(i=r,r={}),this.options=r;var s=this;function a(e){return i?(setTimeout((function(){i(void 0,e)}),0),!0):e}e=this.castInput(e),n=this.castInput(n),e=this.removeEmpty(this.tokenize(e));var l=(n=this.removeEmpty(this.tokenize(n))).length,u=e.length,c=1,d=l+u;r.maxEditLength&&(d=Math.min(d,r.maxEditLength));var f=null!==(t=r.timeout)&&void 0!==t?t:1/0,p=Date.now()+f,h=[{oldPos:-1,lastComponent:void 0}],v=this.extractCommon(h[0],n,e,0);if(h[0].oldPos+1>=u&&v+1>=l)return a([{value:this.join(n),count:n.length}]);var g=-1/0,m=1/0;function y(){for(var t=Math.max(g,-c);t<=Math.min(m,c);t+=2){var r=void 0,i=h[t-1],d=h[t+1];i&&(h[t-1]=void 0);var f=!1;if(d){var p=d.oldPos-t;f=d&&0<=p&&p<l}var y=i&&i.oldPos+1<u;if(f||y){if(r=!y||f&&i.oldPos+1<d.oldPos?s.addToPath(d,!0,void 0,0):s.addToPath(i,void 0,!0,1),v=s.extractCommon(r,n,e,t),r.oldPos+1>=u&&v+1>=l)return a(o(s,r.lastComponent,n,e,s.useLongestToken));h[t]=r,r.oldPos+1>=u&&(m=Math.min(m,t-1)),v+1>=l&&(g=Math.max(g,t+1))}else h[t]=void 0}c++}if(i)!function e(){setTimeout((function(){if(c>d||Date.now()>p)return i();y()||e()}),0)}();else for(;c<=d&&Date.now()<=p;){var w=y();if(w)return w}},addToPath:function(e,n,t,o){var r=e.lastComponent;return r&&r.added===n&&r.removed===t?{oldPos:e.oldPos+o,lastComponent:{count:r.count+1,added:n,removed:t,previousComponent:r.previousComponent}}:{oldPos:e.oldPos+o,lastComponent:{count:1,added:n,removed:t,previousComponent:r}}},extractCommon:function(e,n,t,o){for(var r=n.length,i=t.length,s=e.oldPos,a=s-o,l=0;a+1<r&&s+1<i&&this.equals(n[a+1],t[s+1]);)a++,s++,l++;return l&&(e.lastComponent={count:l,previousComponent:e.lastComponent}),e.oldPos=s,a},equals:function(e,n){return this.options.comparator?this.options.comparator(e,n):e===n||this.options.ignoreCase&&e.toLowerCase()===n.toLowerCase()},removeEmpty:function(e){for(var n=[],t=0;t<e.length;t++)e[t]&&n.push(e[t]);return n},castInput:function(e){return e},tokenize:function(e){return e.split("")},join:function(e){return e.join("")}},new t;var r=/^[A-Za-z\xC0-\u02C6\u02C8-\u02D7\u02DE-\u02FF\u1E00-\u1EFF]+$/,i=/\S/,s=new t;s.equals=function(e,n){return this.options.ignoreCase&&(e=e.toLowerCase(),n=n.toLowerCase()),e===n||this.options.ignoreWhitespace&&!i.test(e)&&!i.test(n)},s.tokenize=function(e){for(var n=e.split(/([^\S\r\n]+|[()[\]{}'"\r\n]|\b)/),t=0;t<n.length-1;t++)!n[t+1]&&n[t+2]&&r.test(n[t])&&r.test(n[t+2])&&(n[t]+=n[t+2],n.splice(t+1,2),t--);return n};var a=new t;function l(e){return l="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},l(e)}function u(e){return function(e){if(Array.isArray(e))return c(e)}(e)||function(e){if("undefined"!=typeof Symbol&&Symbol.iterator in Object(e))return Array.from(e)}(e)||function(e,n){if(e){if("string"==typeof e)return c(e,n);var t=Object.prototype.toString.call(e).slice(8,-1);return"Object"===t&&e.constructor&&(t=e.constructor.name),"Map"===t||"Set"===t?Array.from(e):"Arguments"===t||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(t)?c(e,n):void 0}}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function c(e,n){(null==n||n>e.length)&&(n=e.length);for(var t=0,o=new Array(n);t<n;t++)o[t]=e[t];return o}a.tokenize=function(e){this.options.stripTrailingCr&&(e=e.replace(/\r\n/g,"\n"));var n=[],t=e.split(/(\n|\r\n)/);t[t.length-1]||t.pop();for(var o=0;o<t.length;o++){var r=t[o];o%2&&!this.options.newlineIsToken?n[n.length-1]+=r:(this.options.ignoreWhitespace&&(r=r.trim()),n.push(r))}return n},(new t).tokenize=function(e){return e.split(/(\S.+?[.!?])(?=\s+|$)/)},(new t).tokenize=function(e){return e.split(/([{}:;,]|\s+)/)};var d=Object.prototype.toString,f=new t;function p(e,n,t,o,r){var i,s;for(n=n||[],t=t||[],o&&(e=o(r,e)),i=0;i<n.length;i+=1)if(n[i]===e)return t[i];if("[object Array]"===d.call(e)){for(n.push(e),s=new Array(e.length),t.push(s),i=0;i<e.length;i+=1)s[i]=p(e[i],n,t,o,r);return n.pop(),t.pop(),s}if(e&&e.toJSON&&(e=e.toJSON()),"object"===l(e)&&null!==e){n.push(e),s={},t.push(s);var a,u=[];for(a in e)e.hasOwnProperty(a)&&u.push(a);for(u.sort(),i=0;i<u.length;i+=1)s[a=u[i]]=p(e[a],n,t,o,a);n.pop(),t.pop()}else s=e;return s}f.useLongestToken=!0,f.tokenize=a.tokenize,f.castInput=function(e){var n=this.options,t=n.undefinedReplacement,o=n.stringifyReplacer,r=void 0===o?function(e,n){return void 0===n?t:n}:o;return"string"==typeof e?e:JSON.stringify(p(e,null,null,r),r,"  ")},f.equals=function(e,n){return t.prototype.equals.call(f,e.replace(/,([\r\n])/g,"$1"),n.replace(/,([\r\n])/g,"$1"))};var h=new t;function v(e,n,t,o,r,i,s){s||(s={}),void 0===s.context&&(s.context=4);var l=function(e,n,t){return a.diff(e,n,t)}(t,o,s);if(l){l.push({value:"",lines:[]});for(var c=[],d=0,f=0,p=[],h=1,v=1,g=function(e){var n=l[e],r=n.lines||n.value.replace(/\n$/,"").split("\n");if(n.lines=r,n.added||n.removed){var i;if(!d){var a=l[e-1];d=h,f=v,a&&(p=s.context>0?y(a.lines.slice(-s.context)):[],d-=p.length,f-=p.length)}(i=p).push.apply(i,u(r.map((function(e){return(n.added?"+":"-")+e})))),n.added?v+=r.length:h+=r.length}else{if(d)if(r.length<=2*s.context&&e<l.length-2){var g;(g=p).push.apply(g,u(y(r)))}else{var m,w=Math.min(r.length,s.context);(m=p).push.apply(m,u(y(r.slice(0,w))));var S={oldStart:d,oldLines:h-d+w,newStart:f,newLines:v-f+w,lines:p};if(e>=l.length-2&&r.length<=s.context){var k=/\n$/.test(t),C=/\n$/.test(o),b=0==r.length&&p.length>S.oldLines;!k&&b&&t.length>0&&p.splice(S.oldLines,0,"\\ No newline at end of file"),(k||b)&&C||p.push("\\ No newline at end of file")}c.push(S),d=0,f=0,p=[]}h+=r.length,v+=r.length}},m=0;m<l.length;m++)g(m);return{oldFileName:e,newFileName:n,oldHeader:r,newHeader:i,hunks:c}}function y(e){return e.map((function(e){return" "+e}))}}h.tokenize=function(e){return e.slice()},h.join=h.removeEmpty=function(e){return e};var g=function(e,n,t,o){return new(t||(t=Promise))((function(r,i){function s(e){try{l(o.next(e))}catch(e){i(e)}}function a(e){try{l(o.throw(e))}catch(e){i(e)}}function l(e){var n;e.done?r(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,a)}l((o=o.apply(e,n||[])).next())}))};const m=e=>g(void 0,void 0,void 0,(function*(){const n=(new TextEncoder).encode(e),t=yield crypto.subtle.digest("SHA-256",n);return Array.from(new Uint8Array(t)).map((e=>e.toString(16).padStart(2,"0"))).join("")})),y=e=>{const n=JSON.stringify(e),t=(new TextEncoder).encode(n).buffer;return new Blob([t])},w=new Map,S=(e,n,t)=>{let o=null;const r=[],i=()=>{let s="wss://dev.service.careflame.ru/getconn";(()=>{const e=navigator.userAgent;return/^((?!chrome|android).)*safari/i.test(e)})()||(s+="/");const a=new WebSocket(s),l={allowChanges:!1},u=()=>{if(l.allowChanges)for(;r.length>0;){const e=r.shift();console.log("Sending request",e),a.send(y(e))}};return a.onopen=()=>{console.log("Connected",e),w.set(e,a),a.send(y({type:"link",data:{link:e,auth_token:n}})),o=setInterval((()=>{a.readyState===WebSocket.OPEN&&a.send(y({type:"ping"}))}),1e4)},a.onmessage=o=>g(void 0,void 0,void 0,(function*(){const r=JSON.parse(yield(e=>g(void 0,void 0,void 0,(function*(){if(e.data instanceof Blob){const n=yield e.data.arrayBuffer(),t=(new TextDecoder).decode(n);return JSON.parse(t)}return e.data})))(o));console.log(r),"issues"===r.type&&(t(r.data),l.allowChanges=!0,u()),"error"===r.type&&console.error("Error",r.data),"request"===r.type&&"want_full"===r.data.message&&a.send(y({type:"link",data:{link:e,auth_token:n}})),"request"===r.type&&"want_diff"===r.data.message&&(l.allowChanges=!0,u())})),a.onclose=n=>{w.delete(e),console.log("Disconnected",n),o&&clearInterval(o),setTimeout((()=>{console.log("Reconnecting..."),i()}),2e3)},a.onerror=e=>console.error("WebSocket Error",e),{onChangeCode:(e,n,t)=>g(void 0,void 0,void 0,(function*(){t?((e,n,t)=>{g(void 0,void 0,void 0,(function*(){const o=v("","",n,t,"","",{context:0});if(o&&o.hunks.length>0){o.hunks.forEach((e=>{e.lines=e.lines.filter((e=>!e.includes("\\ No newline at end of file")))}));const n={type:"diff",data:{files:[{path:e,status:"upd",hash:yield m(t),hunks:o.hunks}]}};l.allowChanges&&a.readyState===WebSocket.OPEN?(console.log("Sending request",n),a.send(y(n))):(console.log("Queueing request",n),r.push(n))}}))})(e,n,t):((e,n)=>{g(void 0,void 0,void 0,(function*(){const t=v("","","",n,"","",{context:0});if(t&&t.hunks.length>0){t.hunks.forEach((e=>{e.lines=e.lines.filter((e=>!e.includes("\\ No newline at end of file")))}));const o={type:"diff",data:{files:[{path:e,status:"add",hash:yield m("")},{path:e,status:"upd",hash:yield m(n),hunks:t.hunks}]}};l.allowChanges&&a.readyState===WebSocket.OPEN?(console.log("Sending request",o),a.send(y(o))):(console.log("Queueing request",o),r.push(o))}}))})(e,n)})),deleteFile:e=>g(void 0,void 0,void 0,(function*(){const n={type:"diff",data:{files:[{path:e,status:"del",hash:yield m(e)}]}};l.allowChanges&&a.readyState===WebSocket.OPEN?(console.log("Sending request",n),a.send(y(n))):(console.log("Queueing request",n),r.push(n))}))}};return i()},k=e=>{const n=w.get(e);n&&(n.close(),w.delete(e))};var C=n.Z,b=n.k;export{C as disconnect,b as register};